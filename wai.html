<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Waiheke Island Webmap</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.28.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.28.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style>
    .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px 'Open Sans', sans-serif;
        z-index: 1
    }
    #menu {
        
        background-color: #595959;
        color: #fff;
        position: absolute;
        z-index: 1;
        top: 1%;
        left: 10px;
        border-radius: 3px;
        width: 220px;        
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 12px;
        color: #fff;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;        
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        
    }

    #menu a:last-child {
        border-radius: 0 0 3px 3px;
    }

    #menu a.active {
        background-color: #fff;
        color: #404040;             
    }
    .legend {
    background-color: #fff;
    border-radius: 3px;
    bottom: 30px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    font: 12px/20px 'Open Sans', sans-serif;
    padding: 10px;
    position: absolute;       
    right: 10px;
    top:50%
    z-index: 1;
    width: 200px;
    }

    .legend h4 {
    font: 20px/20px 'Open Sans', sans-serif;
    margin: 0 0 10px;
    }
    .legend h3 {
    font: 14px 'Open Sans', sans-serif;
    margin: 0 0 10px;
    }

    .legend div p {
    border-radius: 50%;
    display: inline-table;
    height: 10px;
    margin-right: 5px;
    width: 10px;
    }
    .legend div span {
    border-radius: 50%;
    display: inline-block;
    height: 10px;
    margin-right: 5px;
    width: 10px;
}
</style>
<nav id="menu"></nav>
<div id='map'></div>
</div>
<div id='legend' class='legend'>
    <h4>Legend</h4>    
    <img src=images/RIV.PNG style="padding: 2px; width: 25px; height: 25px; vertical-align: middle;"> Waterway<br>
    <img src=images/BUS.PNG style="padding: 2px; width: 25px; height: 25px; vertical-align: middle;"> Bus Route<br>
    <img src=images/MF.PNG style="padding: 2px; width: 25px; height: 25px; vertical-align: middle;"> Marine Farm<br>
    <img src=images/MR.PNG style="padding: 2px; width: 25px; height: 25px; vertical-align: middle;"> Marine Reserve (Existing)<br><br>
    <h3>Marine Protected Area (Proposed by):</h3>
    <div><span style='background-color: #80ff80'></span> Waiheke Local Board</div>
    <div><span style='background-color: #ffff4d'></span> Dr Roger Grace</div>
    <div><span style='background-color: #FF0000'></span> Other</div>   
    <br><h4>Population density</h4>
    <div><span style='background-color: #E50025'></span>2000 per km2</div>
    <div><span style='background-color: #DD6000'></span>1600 per km2</div>    
    <div><span style='background-color: #CED500'></span>1200 per km2</div>    
    <div><span style='background-color: #4BCE00'></span>800 per km2</div>    
    <div><span style='background-color: #00C62E'></span>400 per km2</div>    
    <div><span style='background-color: #00BF9F'></span>Less than 200 per km2</div>

  </div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYW5kcmV3ODQ1NTUiLCJhIjoiY2lydnp2Nzk3MGoza2ZnbTh1b2FoenFqYSJ9.iPSB6vUKQLifDYV570B8zg';
var bounds = [
    [174.79283, -36.9550926588],
    [175.235291, -36.698655]
];

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/andrew84555/cixqu0baq00052sp261tqlqxa',
    //this is just the basic mapbox outdoor style, but with road markers removed so they do not conflict with the bus route one.
    center: [175.1080, - 36.80],
    zoom: 12,
    minZoom: 12,
    maxZoom: 14,
    maxBounds: bounds
    

});
map.on('load', function() {
    map.addSource('Turbidity', {
            type: 'image',
            url: 'images/turb.png',
            coordinates: [
                [174.9026590331, -36.6761008308],
                [175.2885053471, -36.6761008308],
                [175.2885053471, -36.9550926588],
                [174.9026590331, -36.9550926588]
            ]
        });
    map.addLayer({
            id: 'Turbidity Overlay',
            source: 'Turbidity',
            type: 'raster',
        }); 
    map.addSource("Te Matuku Marine Reserve", {
        "type": 'geojson',
        "data": 'json/matuku.geojson'
    });

    map.addLayer({
        "id": "Te Matuku Marine Reserve",
        "type": "fill",
        "source": "Te Matuku Marine Reserve",        
        "paint": {            
            "fill-color": "#0000ff",
            "fill-outline-color": "#0000ff",        
            "fill-opacity": 0.5
        }
    });

    map.addSource('Other Proposed Reserves', {
        "type": 'geojson',
        "data": 'json/other_proposed_MR.geojson'
    });

    map.addLayer({
        "id": "Other Proposed Reserves",
        "type": "fill",
        "source": "Other Proposed Reserves",
        "paint": {            
            "fill-color": "#FF0000",
            "fill-outline-color": "#FF0000",        
            "fill-opacity": 0.5
        }
    });  
    map.addSource('Marine Farms', {
        type: 'geojson',
        data: 'json/MF.geojson'
    });

    map.addLayer({
        "id": "Marine Farms",
        "type": "fill",
        "source": "Marine Farms",
        "paint": {            
            "fill-color": "#ff6600",
            "fill-outline-color": "#ff6600",        
            "fill-opacity": 0.5
        }
    });
    map.addSource('Proposed Marine Reserves (Dr Roger Grace)', {
        "type": 'geojson',
        "data": 'json/roger_grace.geojson'
    });

    map.addLayer({
        "id": "Proposed Marine Reserves (Dr Roger Grace)",
        "type": "fill",
        "source": "Proposed Marine Reserves (Dr Roger Grace)",                
        "paint": {            
            "fill-color": "#ffff4d",
            "fill-outline-color": "#ffff4d",        
            "fill-opacity": 0.5
        }
    });
    map.addSource('Proposed Marine Reserves (Waiheke Local Board)', {
        "type": 'geojson',
        "data": 'json/WLB_MR.geojson'
    });
    map.addLayer({
        "id": "Proposed Marine Reserves (Waiheke Local Board)",
        "type": "fill",
        "source": "Proposed Marine Reserves (Waiheke Local Board)",
        "paint": {            
            "fill-color": "#80ff80",
            "fill-outline-color": "#80ff80",        
            "fill-opacity": 0.5
        }
    },'place_label_other');
    map.addSource('rivers', {
        "type": 'geojson',
        "data": 'json/rivers.geojson'
    });
    map.addLayer({
        "id": "Waterways",
        "type": "line",
        "source": "rivers",
        "layout": {
            "line-join": "round",
            "line-cap": "round",
            
        },
        "paint": {
            "line-color": "#0066ff",
            "line-width": 1,
            "line-dasharray": [1, 2]
            }
    },'place_label_other');
 
    map.addSource("population", {
        'type': 'geojson',
        'data': 'json/MB.geojson'
    });
    map.addLayer({
        'id': 'Population density 2001 (per km2)',
        'source': 'population',             
        'type': 'fill',
        'paint': {
            'fill-color': {
                property: 'NORM_01',
                stops: [
                    [0, '#00BF9F'],
                    [200, '#00C267'],
                    [400, '#00C62E'],
                    [600, '#0DCA00'],
                    [800, '#4BCE00'],
                    [1000, '#8CD200'],
                    [1200, '#CED500'],
                    [1400, '#D99F00'],
                    [1600, '#DD6000'],
                    [1800, '#E11E00'],
                    [2000, '#E50025']
                ]
            },
            'fill-opacity': 1
        }
    }, 'place_label_other');
    map.addLayer({
        'id': 'Population density 2006 (per km2)',
        'source': 'population',              
        'type': 'fill',
        'paint': {
            'fill-color': {
                property: 'NORM_06',
                stops: [
                    [0, '#00BF9F'],
                    [200, '#00C267'],
                    [400, '#00C62E'],
                    [600, '#0DCA00'],
                    [800, '#4BCE00'],
                    [1000, '#8CD200'],
                    [1200, '#CED500'],
                    [1400, '#D99F00'],
                    [1600, '#DD6000'],
                    [1800, '#E11E00'],
                    [2000, '#E50025']
                ]
            },
            'fill-opacity': 1
        }
    }, 'place_label_other');
    map.addLayer({
        'id': 'Population density 2013 (per km2)',
        'source': 'population',              
        'type': 'fill',
        'paint': {
            'fill-color': {
                property: 'NORM_13',
                stops: [
                    [0, '#00BF9F'],
                    [200, '#00C267'],
                    [400, '#00C62E'],
                    [600, '#0DCA00'],
                    [800, '#4BCE00'],
                    [1000, '#8CD200'],
                    [1200, '#CED500'],
                    [1400, '#D99F00'],
                    [1600, '#DD6000'],
                    [1800, '#E11E00'],
                    [2000, '#E50025']
                ]
            },
            'fill-opacity': 1
        }
    }, 'place_label_other');

    map.addSource("Bus route", {
        //this pulls from a text file saved as a geojson, much cleaner than having it in the code. It can be in a folder or just in the same root folder as it is in here. The data was scraped from OSM, downloaded as a esri shapefile, and converted to a geojson file by uploading the zipped shapefile to mapshaper (www.mapshaper.org). 
        "type": "geojson", 
        "data": "json/bus_waiheke.geojson"
    });
    map.addLayer({
        "id": "Bus route",
        "type": "line",
        "source": "Bus route",
        "layout": {
            "line-join": "round",
            "line-cap": "round",
        },
        "paint": {
            "line-color": "#ff8080",
            "line-width": 4
        }
    },'place_label_other');
    map.addLayer({
        "id": "labels",
        "type": "symbol",
        "source": "Bus route",
        "layout": {
            //this means your labels follow the line, looks much nicer than if they just float free. 
            "symbol-placement": 'line',
            "text-field": "{name}",//just pulls from the geojson.
            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
            "text-size": 11,
        }
     });
    map.addSource("Toilets", {
        "type": "geojson", 
        "data": "json/toilet.geojson"
    });
    map.addLayer({
        "id": "Toilets",
        "type": "symbol",
        "source": "Toilets",
        "layout": {
            "icon-image": "toilet-15",
        }
    });
    map.addSource("Ferry", {
        "type": "geojson", 
        "data": "json/ferry.geojson"
    });
    map.addLayer({
        "id": "Ferry Terminals",
        "type": "symbol",
        "source": "Ferry",
        "layout": {
            "icon-image": "ferry-15",
        }
    });
    map.addSource("Bus stops", {
        "type": "geojson", 
        "data": "json/bus_stop.geojson"
    });
    map.addLayer({
        "id": "Bus stops",
        "type": "symbol",
        "source": "Bus stops",
        "layout": {
            "icon-image": "marker-11",
            "text-field": "{stop_name}",
            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
            "text-offset": [1, 1],
            "text-size": 8,
            "text-anchor": "left"
        }
    });
    map.setLayerZoomRange('Bus stops', 14, 20);    
});

//just stick the ids of the layers you want to be able to turn off and on here.
var toggleableLayerIds = ['Te Matuku Marine Reserve', 'Proposed Marine Reserves (Waiheke Local Board)', 'Proposed Marine Reserves (Dr Roger Grace)', 'Other Proposed Reserves', 'Marine Farms', 'Bus route', 'Bus stops', 'Ferry Terminals', 'Toilets', 'Waterways', 'Population density 2001 (per km2)','Population density 2006 (per km2)', 'Population density 2013 (per km2)', 'Turbidity Overlay'];
for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];
    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = id;
    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();
        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };
    var layers = document.getElementById('menu');
    layers.appendChild(link);
}
//this adds a zoom in and out control, very simple and useful for people who do not have other means to control zoom level. 
map.addControl(new mapboxgl.NavigationControl());
map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['Proposed Marine Reserves (Dr Roger Grace)', 'Proposed Marine Reserves (Waiheke Local Board)', 'Te Matuku Marine Reserve', 'Other Proposed Reserves'] });

    if (!features.length) {
        return;
    }

    var feature = features[0];

    // Populate the popup and set its coordinates
    // based on the feature found.
    var popup = new mapboxgl.Popup()
        .setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.name + '<i><b><br>Area:  </i></b>' + feature.properties.area + ' ha   ')
        .addTo(map);
});

// Use the same approach as above to indicate that the symbols are clickable
// by changing the cursor style to 'pointer'.
map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['Proposed Marine Reserves (Dr Roger Grace)', 'Proposed Marine Reserves (Waiheke Local Board)', 'Te Matuku Marine Reserve', 'Other Proposed Reserves'] });
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
});
</script>

</body>
</html>